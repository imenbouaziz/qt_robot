<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maths pour Enfants - Robot Interactif</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet" />

  <!-- Import Map for Three.js + GLTFLoader -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
        "three/examples/jsm/loaders/GLTFLoader.js": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/loaders/GLTFLoader.js"
      }
    }
  </script>
  <!-- Script Three.js -->
  <script type="module" src="{{ url_for('static', filename='js/threetest.js') }}"></script>

  <style>
    html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: linear-gradient(135deg, #ff9a9e, #fad0c4);
}

body {
  text-align: center;
}
h1 {
  text-align: center;
  font-size: 3.5em;
  color: #c7921f;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
  margin-bottom: 20px;
}


    #sceneCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 0;           /* tout en bas mais visible */
    display: block;
    pointer-events: none; /* pour ne pas g√™ner les clics */
    background: transparent;
    }

    .section, h1 {
    position: relative;
    z-index: 1;           /* plus haut que le canvas */
    }


    .section {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 20px;
      padding: 20px;
      margin: 20px auto;
      max-width: 800px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 10;
    }

    #operation {
      font-size: 1.2em;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #48c428;
      background: #fff;
      margin: 10px;
    }

    #problem {
      font-size: 3em;
      margin: 20px 0;
    }

    #userAnswer {
      font-size: 1.5em;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #ff6f61;
      width: 150px;
      margin: 10px;
    }

    button {
      font-size: 1.5em;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      background-color: #ff6f61;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
    }

    button:hover {
      background-color: #ff3b2f;
      transform: scale(1.05);
    }

    .horizontal-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }

    .emoji-container {
      display: flex;
      gap: 10px;
    }

    .emoji-button {
      font-size: 40px;
      border: none;
      background: transparent;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .emoji-button:hover {
      transform: scale(1.2);
    }

    #score {
      font-size: 1.5em;
    }
  </style>
</head>
<body>
  <!-- Canvas Three.js (robot 3D en fond) -->
  <canvas id="sceneCanvas"></canvas>

  
  <!-- Titre -->
  <h1>Maths pour Enfants - Robot Interactif</h1>

  <!-- Menu op√©ration -->
  <div class="section">
    <label for="operation">Choisissez une op√©ration :</label>
    <select id="operation" onchange="generateProblem(this.value)">
      <option value="addition">Addition</option>
      <option value="soustraction">Soustraction</option>
      <option value="multiplication">Multiplication</option>
    </select>
  </div>

  <!-- Probl√®me -->
  <div class="section">
    <div id="problem"></div>
    <input type="number" id="userAnswer" placeholder="Votre r√©ponse" />
    <button onclick="checkAnswer()">R√©pondre</button>
    <input type="hidden" id="correctAnswer" />
  </div>

  <!-- Score + emojis -->
  <div class="section">
    <div class="horizontal-container">
      <div id="score">Score : 0</div>
      <div class="emoji-container">
        <button class="emoji-button" onclick="handleEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</button>
        <button class="emoji-button" onclick="handleEmoji('üôÇ')">üôÇ</button>
        <button class="emoji-button" onclick="handleEmoji('üòî')">üòî</button>
        <button class="emoji-button" onclick="handleEmoji('üò†')">üò†</button>
      </div>
    </div>
  </div>

  <!-- Script logique math√©matique + √©motions -->
  <script>
    let score = 0;

    function speak(text) {
      const msg = new SpeechSynthesisUtterance(text);
      window.speechSynthesis.speak(msg);
    }

    function playSound(type) {
      const sound = new Audio();
      switch (type) {
        case 'happy':
          sound.src = 'https://www.soundjay.com/human/family-cheer-01.mp3';
          break;
        case 'sad':
          sound.src = 'https://www.soundjay.com/human/children-sigh-01.mp3';
          break;
        case 'angry':
          sound.src = 'https://www.soundjay.com/human/angry-01.mp3';
          break;
        case 'love':
          sound.src = 'https://www.soundjay.com/human/heartbeat-01.mp3';
          break;
      }
      sound.play();
    }

    function changeFace(expression) {
      speak(expression === 'happy' ? "Bravo !" :
            expression === 'sad' ? "R√©essaye encore !" :
            expression === 'angry' ? "Pourquoi es-tu en col√®re ?" :
            "Merci pour le c≈ìur !");
      playSound(expression);
    }

    function generateProblem(operation) {
      let num1 = Math.floor(Math.random() * 10) + 1;
      let num2 = Math.floor(Math.random() * 10) + 1;
      let result;

      if (operation === 'addition') {
        result = num1 + num2;
        document.getElementById("problem").innerHTML = `${num1} + ${num2}`;
      } else if (operation === 'soustraction') {
        result = num1 - num2;
        document.getElementById("problem").innerHTML = `${num1} - ${num2}`;
      } else if (operation === 'multiplication') {
        result = num1 * num2;
        document.getElementById("problem").innerHTML = `${num1} √ó ${num2}`;
      }

      document.getElementById("correctAnswer").value = result;
    }

    function checkAnswer() {
      let userAnswer = document.getElementById("userAnswer").value;
      let correctAnswer = document.getElementById("correctAnswer").value;

      if (userAnswer == correctAnswer) {
        changeFace('happy');
        score += 10;
      } else {
        changeFace('sad');
        score -= 5;
      }

      document.getElementById("score").innerText = "Score : " + score;
      document.getElementById("userAnswer").value = "";
      setTimeout(() => {
        generateProblem(document.getElementById("operation").value);
      }, 1500);
    }

    function handleEmoji(emoji) {
  if (emoji === "‚ù§Ô∏è") {
    changeFace('love');
    setExpression('Happy');
    playAnimation('Wave');
  } else if (emoji === "üôÇ") {
    changeFace('happy');
    setExpression('Amazed');
    playAnimation('Idle');
  } else if (emoji === "üòî") {
    changeFace('sad');
    setExpression('Sad');
    playAnimation('Sad_Baked');
  } else if (emoji === "üò†") {
    changeFace('angry');
    setExpression('Angry');
    playAnimation('Bravo');
  }
}

    window.onload = () => generateProblem('addition');
  </script>
</body>
</html>
